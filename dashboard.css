/* ==========================================================================
   1. CORE VARIABLES
   ========================================================================== */
:root {
  --max: 1600px; /* Reduced max-width to prevent extreme stretching */
  --gutter: clamp(12px, 2vw, 24px);
  --gap: 12px;
  --text: rgba(236, 239, 244, .94);
  --muted: rgba(236, 239, 244, .60);
  --card: rgba(59, 66, 82, .45);
  --border: rgba(236, 239, 244, .10);
  --shadow: 0 12px 40px rgba(0, 0, 0, .25);
  --accent: #9687cf;
  --radius: 16px;
  --radius-sm: 12px;
  
  /* Responsive Tile Sizing */
  --col-min: 240px; 
  --col-max: 1fr;
  --tile-h: 70px;
  --tile-icon: 42px;
}

/* ==========================================================================
   2. THEMES (Light, Dark, Midnight, Frost)
   ========================================================================== */
[data-theme="light"] {
  --text: #2e3440; --muted: #4c566a; --card: rgba(255, 255, 255, .7);
  --border: rgba(0,0,0,.08); background: #eceff4;
}

[data-theme="dark"] {
  --text: #eceff4; --muted: #d8dee9; --card: rgba(46, 52, 64, .6);
  --border: rgba(255,255,255,.08); background: #2e3440;
}

[data-theme="midnight"] {
  --text: #f2f5ff; --card: rgba(12, 18, 34, .6);
  background: radial-gradient(circle at 50% 50%, #050a18, #02040c);
}

[data-theme="frost"] {
  --nord0: #2e3440; --nord1: #3b4252; --nord2: #434c5e; --nord8: #88c0d0;
  --text: #eceff4; --muted: #a3be8c; --accent: #88c0d0;
  --card: rgba(59, 66, 82, 0.9);
  --border: rgba(136, 192, 208, 0.2);
  background: var(--nord0) !important;
}

/* ==========================================================================
   3. GLOBAL & LAYOUT
   ========================================================================== */
* { box-sizing: border-box; }
body {
  margin: 0; font-family: 'Quicksand', sans-serif;
  color: var(--text); background-attachment: fixed; line-height: 1.5;
}

.app { min-height: 100vh; display: flex; flex-direction: column; }

/* LAYOUT MODES */
body[data-layout="compact"] { --tile-h: 56px; --tile-icon: 32px; --col-min: 200px; }
body[data-layout="large"] { --tile-h: 84px; --tile-icon: 50px; --col-min: 300px; }

/* ==========================================================================
   4. TOPBAR
   ========================================================================== */
.topbar {
  position: sticky; top: 0; z-index: 100;
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  background: color-mix(in srgb, var(--card) 80%, black);
}
.topbar-inner {
  max-width: var(--max); margin: 0 auto; padding: 12px var(--gutter);
  display: flex; justify-content: space-between; align-items: center;
}
.topbar-center { display: flex; align-items: center; gap: 20px; flex: 1; justify-content: center; }

.search {
  background: rgba(0,0,0,.1); border: 1px solid var(--border);
  border-radius: 20px; padding: 6px 15px; display: flex; align-items: center; gap: 10px;
  width: 100%; max-width: 400px;
}
.search input { background: transparent; border: 0; color: inherit; width: 100%; outline: none; }

/* ==========================================================================
   5. GRID & TILES
   ========================================================================== */
main { max-width: var(--max); margin: 0 auto; padding: 20px var(--gutter); width: 100%; }

/* QUICK LINKS ROW */
.quick-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--gap);
  margin-bottom: 30px;
}

/* MAIN CATEGORY COLUMNS */
.columns {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(var(--col-min), var(--col-max)));
  gap: var(--gap);
  align-items: start;
}

.category {
  background: var(--card); border: 1px solid var(--border);
  border-radius: var(--radius); overflow: hidden;
  box-shadow: var(--shadow); height: fit-content;
}

.cat-head {
  padding: 12px 15px; background: rgba(0,0,0,.15);
  display: flex; align-items: center; gap: 10px;
  border-bottom: 1px solid var(--border);
  font-weight: 700; color: var(--accent);
}

.cat-body { padding: 10px; display: flex; flex-direction: column; gap: 8px; }

/* THE TILES */
.tile {
  display: flex; align-items: center; gap: 12px;
  padding: 10px; min-height: var(--tile-h);
  background: rgba(255,255,255,.03); border: 1px solid var(--border);
  border-radius: var(--radius-sm); text-decoration: none; color: inherit;
  transition: all 0.2s ease;
}
.tile:hover {
  transform: translateY(-2px);
  background: rgba(255,255,255,.07);
  border-color: var(--accent);
}

/* ICON FIX - THIS WAS THE CULPRIT */
.tile-icon {
  width: var(--tile-icon); height: var(--tile-icon);
  flex-shrink: 0; border-radius: 8px;
  background: rgba(0,0,0,.2); overflow: hidden;
  display: flex; align-items: center; justify-content: center;
}
.tile-icon img {
  width: 80%; height: 80%; object-fit: contain; /* Correctly scales icons */
}

.tile-text { min-width: 0; }
.tile-title { font-weight: 600; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.tile-meta { font-size: 12px; color: var(--muted); }

/* ==========================================================================
   6. PREFERENCES PANEL
   ========================================================================== */
.prefs-panel {
  position: absolute; right: var(--gutter); top: 70px;
  background: var(--nord1); border: 1px solid var(--border);
  padding: 15px; border-radius: var(--radius);
  display: none; flex-direction: column; gap: 10px;
  box-shadow: var(--shadow); z-index: 1000;
}
body[data-prefs="open"] .prefs-panel { display: flex; }

.field { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
.field select { background: #2e3440; color: white; border: 1px solid var(--border); padding: 4px; border-radius: 4px; }

/* ==========================================================================
   7. RESPONSIVE
   ========================================================================== */
@media (max-width: 800px) {
  .topbar-inner { flex-direction: column; gap: 10px; }
  .columns { grid-template-columns: 1fr; }
}
