:root {
  --max: min(2200px, 100vw);
  --gutter: clamp(10px, 1.35vw, 18px);

  --text: rgba(236, 239, 244, .94);
  --muted: rgba(236, 239, 244, .68);

  --card: rgba(59, 66, 82, .48);
  --border: rgba(236, 239, 244, .12);
  --shadow: 0 18px 50px rgba(0, 0, 0, .35);

  --accent: #9687cf;

  --radius: 18px;
  --radius-sm: 14px;

  --gap: 10px;

  --col-min: 200px;
  --col-max: 260px;

  --tile-h: 60px;
  --tile-pad-y: 10px;
  --tile-pad-x: 12px;
  --tile-icon: 40px;

  --accentA: color-mix(in srgb, var(--accent) 55%, transparent);
  --accentB: color-mix(in srgb, var(--accent) 22%, transparent);

  --midnight-bg: url("https://cmd-q.net/background4.jpg");
  --stars-dim: .30;
  --aurora-alpha: .34;
  --aurora-blur: 34px;
}

/* ==========================================================================
   THEME DEFINITIONS
   ========================================================================== */

[data-theme="light"] {
  --text: rgba(35, 40, 52, .92);
  --muted: rgba(35, 40, 52, .62);
  --card: rgba(255, 255, 255, .64);
  --border: rgba(35, 40, 52, .12);
  --shadow: 0 18px 50px rgba(0, 0, 0, .18);
  background:
    radial-gradient(900px 500px at 15% 15%, rgba(150, 135, 207, .14), transparent 55%),
    radial-gradient(900px 500px at 85% 20%, rgba(163, 190, 140, .11), transparent 55%),
    radial-gradient(900px 500px at 55% 90%, rgba(191, 97, 106, .09), transparent 55%),
    linear-gradient(180deg, #e5e9f0, #eceff4);
}

[data-theme="dark"] {
  --text: rgba(245, 246, 248, .92);
  --muted: rgba(245, 246, 248, .66);
  --card: rgba(22, 24, 28, .44);
  --border: rgba(255, 255, 255, .12);
  --shadow: 0 20px 70px rgba(0, 0, 0, .55);
  background:
    radial-gradient(1200px 700px at 20% 10%, rgba(150, 135, 207, .16), transparent 60%),
    radial-gradient(900px 600px at 80% 20%, rgba(255, 115, 190, .10), transparent 60%),
    radial-gradient(900px 600px at 60% 85%, rgba(120, 255, 196, .09), transparent 60%),
    linear-gradient(180deg, #0b0c0f, #0f1116);
}

/* REFINED NORD FROST THEME */
[data-theme="frost"] {
  --nord0: #2e3440; 
  --nord1: #3b4252; 
  --nord2: #434c5e; 
  --nord4: #d8dee9; 
  --nord6: #eceff4; 
  --nord8: #88c0d0; 

  --text: var(--nord6);
  --muted: rgba(216, 222, 233, 0.7);
  --card: rgba(59, 66, 82, 0.85); 
  --border: rgba(136, 192, 208, 0.2);
  --shadow: 0 20px 50px rgba(0, 0, 0, 0.35);
  --accent: var(--nord8);
  --radius: 14px;
  --radius-sm: 10px;

  background: var(--nord0) !important;
  background-attachment: fixed;
}

[data-theme="midnight"] {
  --text: rgba(242, 245, 255, .94);
  --muted: rgba(242, 245, 255, .70);
  --card: rgba(12, 18, 34, .50);
  --border: rgba(210, 220, 255, .13);
  --shadow: 0 18px 70px rgba(0, 0, 0, .60);
  background:
    radial-gradient(1200px 900px at 50% 55%, rgba(6, 10, 22, .55), rgba(6, 10, 22, .82) 70%),
    linear-gradient(180deg,
      rgba(0,0,0,calc(1 - var(--stars-dim))) 0%,
      rgba(0,0,0,calc(1 - (var(--stars-dim) * .75))) 55%,
      rgba(0,0,0,calc(1 - (var(--stars-dim) * .60))) 100%
    ),
    radial-gradient(1200px 800px at 50% 40%, rgba(0, 0, 0, .10), rgba(0, 0, 0, .55) 70%),
    linear-gradient(180deg, #050a18, #02040c);
  background-attachment: fixed;
  position: relative;
}

/* ==========================================================================
   LAYOUTS & BASE
   ========================================================================== */

body[data-layout="compact"] { --col-min: 180px; --col-max: 240px; --gap: 9px; --tile-h: 62px; --tile-pad-y: 10px; --tile-pad-x: 10px; --tile-icon: 44px; }
body[data-layout="medium"] { --col-min: 200px; --col-max: 260px; --gap: 10px; --tile-h: 60px; --tile-icon: 40px; }
body[data-layout="large"] { --col-min: 190px; --col-max: 255px; --gap: 8px; --tile-h: 76px; --tile-icon: 48px; }

@media (min-width: 1600px) {
  body[data-layout="large"] { --col-min: 185px; --col-max: 250px; }
}

* { box-sizing: border-box; }
html, body { height: 100%; }

body {
  margin: 0;
  font-family: "Quicksand", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color: var(--text);
  background-attachment: fixed;
  font-weight: 400;
  letter-spacing: .1px;
  position: relative;
  isolation: isolate;
}

/* Midnight Overlays */
body[data-theme="midnight"]::after {
  content: ""; position: fixed; inset: 0; pointer-events: none; z-index: -2;
  background: var(--midnight-bg) center/cover no-repeat;
  transform: scale(1.02); opacity: .55; filter: brightness(.15) contrast(.98) saturate(.85) blur(.15px);
}

body[data-theme="midnight"]::before {
  content: ""; position: fixed; inset: 0; pointer-events: none; z-index: -1;
  opacity: var(--aurora-alpha); filter: blur(var(--aurora-blur)) saturate(1.25);
  mix-blend-mode: screen;
  background:
    radial-gradient(900px 420px at 18% 22%, color-mix(in srgb, var(--accent) 55%, transparent), transparent 72%),
    radial-gradient(1100px 520px at 82% 18%, color-mix(in srgb, var(--accent) 28%, rgba(94, 227, 161, .40)), transparent 74%),
    radial-gradient(1000px 560px at 60% 82%, color-mix(in srgb, var(--accent) 22%, rgba(167, 139, 250, .38)), transparent 78%),
    linear-gradient(90deg, transparent 0%, color-mix(in srgb, var(--accent) 14%, transparent) 38%, transparent 72%);
}

.midnight-noise { position: fixed; inset: 0; pointer-events: none; z-index: 0; display: none; }
body[data-theme="midnight"] .midnight-noise {
  display: block; opacity: .085; mix-blend-mode: overlay;
  background-image:
    repeating-linear-gradient(0deg, rgba(255, 255, 255, .018) 0px, rgba(255, 255, 255, .018) 1px, rgba(0, 0, 0, 0) 2px, rgba(0, 0, 0, 0) 4px),
    repeating-linear-gradient(90deg, rgba(0, 0, 0, .018) 0px, rgba(0, 0, 0, .018) 1px, rgba(0, 0, 0, 0) 2px, rgba(0, 0, 0, 0) 4px);
}

.app { min-height: 100%; display: flex; flex-direction: column; position: relative; z-index: 1; }

/* ==========================================================================
   TOPBAR
   ========================================================================== */

.topbar {
  position: sticky; top: 0; z-index: 50;
  backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--border);
}

body[data-theme="dark"] .topbar { background: rgba(16, 18, 22, .50); box-shadow: 0 10px 40px rgba(0, 0, 0, .40); }
body[data-theme="midnight"] .topbar { background: rgba(6, 10, 22, .48); box-shadow: 0 10px 40px rgba(0, 0, 0, .50); }
body[data-theme="light"] .topbar { background: rgba(255, 255, 255, .70); box-shadow: 0 10px 30px rgba(0, 0, 0, .10); }
body[data-theme="frost"] .topbar { background: rgba(46, 52, 64, 0.9) !important; box-shadow: 0 10px 40px rgba(0, 0, 0, .42); border-bottom: 1px solid var(--border) !important; }

.topbar-inner { max-width: var(--max); margin: 0 auto; padding: 10px var(--gutter); display: grid; grid-template-columns: 1fr auto 1fr; gap: 10px; align-items: center; }
.topbar-left { min-width: 1px; }
.topbar-center { display: flex; align-items: center; justify-content: center; gap: 14px; }
.topbar-right { display: flex; justify-content: flex-end; align-items: center; }

.brand { display: flex; align-items: center; gap: 10px; min-width: 0; }
.brand-badge {
  width: 34px; height: 34px; border-radius: 12px;
  background: linear-gradient(135deg, color-mix(in srgb, var(--accent) 60%, transparent), rgba(191, 97, 106, .18));
  border: 1px solid var(--border); box-shadow: 0 10px 25px rgba(0, 0, 0, .18);
  display: grid; place-items: center; user-select: none; overflow: hidden;
}
.brand-badge img { width: 20px; height: 20px; object-fit: contain; filter: drop-shadow(0 2px 6px rgba(0, 0, 0, .25)); }
.brand-title strong { font-size: 14px; line-height: 1.1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; letter-spacing: .15px; font-weight: 500; }

.search { width: min(420px, 44vw); display: flex; align-items: center; gap: 10px; padding: 8px 12px; border-radius: 999px; border: 1px solid var(--border); box-shadow: 0 10px 20px rgba(0, 0, 0, .14); }
body[data-theme="dark"] .search, body[data-theme="midnight"] .search { background: rgba(255, 255, 255, .055); }
body[data-theme="light"] .search { background: rgba(0, 0, 0, .03); }
body[data-theme="frost"] .search { background: rgba(255, 255, 255, .06); }

.search input { width: 100%; background: transparent; border: 0; outline: 0; color: var(--text); font-size: 13px; font-family: inherit; }

/* ==========================================================================
   PREFERENCES
   ========================================================================== */

.prefs-drawer { position: relative; display: inline-flex; align-items: center; }
.prefs-toggle { height: 36px; padding: 0 12px; border-radius: 999px; border: 1px solid var(--border); cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-size: 12px; font-weight: 600; color: var(--text); transition: transform .12s ease; }
body[data-theme="frost"] .prefs-toggle { background: rgba(255, 255, 255, .06); }

.prefs-panel {
  position: absolute; right: 0; top: 50%; z-index: 60;
  display: inline-flex; align-items: center; gap: 10px; padding: 6px;
  border-radius: 999px; border: 1px solid var(--border); box-shadow: 0 14px 40px rgba(0, 0, 0, .22);
  backdrop-filter: blur(16px); transform: translateY(-50%) translateX(10px) scaleX(.12);
  opacity: 0; visibility: hidden; transition: opacity .18s, transform .18s;
}
body[data-prefs="open"] .prefs-panel { opacity: 1; visibility: visible; transform: translateY(-50%) translateX(0) scaleX(1); }
body[data-theme="frost"] .prefs-panel { background-color: rgba(46, 52, 64, .95); }

/* ==========================================================================
   CATEGORIES & TILES
   ========================================================================== */

.columns { display: grid; grid-template-columns: repeat(auto-fit, minmax(var(--col-min), var(--col-max))); gap: var(--gap); justify-content: center; }

.category {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
  box-shadow: var(--shadow); overflow: hidden; position: relative; backdrop-filter: blur(12px);
}

/* FIXED FROST HEADERS */
.cat-head {
  padding: 10px 12px; display: flex; align-items: center; justify-content: space-between; gap: 10px;
  border-bottom: 1px solid rgba(255, 255, 255, .10);
  background: linear-gradient(180deg, rgba(0, 0, 0, .10), transparent), linear-gradient(90deg, color-mix(in srgb, var(--cat-color) 65%, transparent), transparent 70%);
}

body[data-theme="frost"] .cat-head,
body[data-theme="frost"] .switch-heading {
  background: var(--nord2) !important;
  border-bottom: 1px solid var(--border) !important;
  color: var(--nord8) !important;
}

.tile {
  display: flex; align-items: center; gap: 12px; padding: var(--tile-pad-y) var(--tile-pad-x);
  min-height: var(--tile-h); border-radius: var(--radius-sm); border: 1px solid rgba(255, 255, 255, .12);
  text-decoration: none; color: var(--text); position: relative; overflow: hidden;
  transition: transform .12s, background .12s, border-color .12s;
}

body[data-theme="frost"] .tile { background: var(--nord1); border: 1px solid rgba(136, 192, 208, 0.1); }

/* ICY SHIMMER EFFECT */
body[data-theme="frost"] .tile::after {
  content: ""; position: absolute; top: 0; left: -150%; width: 100%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
  transform: skewX(-25deg); transition: left 0.65s ease; pointer-events: none; z-index: 2;
}
body[data-theme="frost"] .tile:hover::after { left: 150%; }

.tile:hover { transform: translateY(-2px); border-color: color-mix(in srgb, var(--accent) 45%, rgba(255, 255, 255, .18)); box-shadow: 0 14px 40px rgba(0, 0, 0, .28); }
body[data-theme="frost"] .tile:hover { background: var(--nord2); border-color: var(--nord8); }

.tile-icon { width: var(--tile-icon); height: var(--tile-icon); border-radius: 12px; background: rgba(0, 0, 0, .14); border: 1px solid rgba(255, 255, 255, .12); overflow: hidden; flex: 0 0 auto; display: grid; place-items: center; position: relative; z-index: 1; }
body[data-theme="frost"] .tile-icon { border-radius: 10px; background: rgba(0, 0, 0, 0.2); border-color: rgba(255,255,255,0.14); }

.tile-text { min-width: 0; display: flex; flex-direction: column; gap: 4px; flex: 1 1 auto; position: relative; z-index: 1; }
.tile-title { font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.tile-meta { font-size: 12px; color: var(--muted); line-height: 1.25; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }

/* ==========================================================================
   SWITCH PAGE
   ========================================================================== */

.switch-page { min-height: 100%; padding: 18px var(--gutter) 44px; display: flex; flex-direction: column; align-items: center; gap: 12px; }
.switch-columns { width: 100%; max-width: min(1120px, var(--max)); display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; }
.switch-columns .column { width: clamp(260px, 24vw, 305px); border-radius: 20px; border: 1px solid var(--border); overflow: hidden; backdrop-filter: blur(14px); background: color-mix(in srgb, var(--card) 62%, transparent); }

.switch-heading { margin: 0; padding: 9px 12px; text-align: center; font-size: 16px; font-weight: 900; letter-spacing: .28px; border-bottom: 1px solid var(--border); color: color-mix(in srgb, var(--accent) 58%, var(--text)); }

.switch-list { list-style: none; padding: 6px 8px 10px; margin: 0; display: flex; flex-direction: column; gap: 6px; }
.switch-list li { display: grid; grid-template-columns: minmax(0, 1fr) max-content; column-gap: 8px; align-items: center; padding: 5px 8px; border-radius: 12px; transition: background .12s, transform .12s; }
.switch-list li:hover { transform: translateY(-1px); background: color-mix(in srgb, var(--accent) 8%, transparent); border: 1px solid var(--border); }

.switch-name { font-size: 12.5px; font-weight: 800; color: color-mix(in srgb, var(--accent) 55%, var(--text)); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.switch-ip { font-size: 11px; font-weight: 900; padding: 2px 7px; border-radius: 999px; background: rgba(0, 0, 0, 0.2); color: var(--muted); font-variant-numeric: tabular-nums; }

/* ==========================================================================
   RESPONSIVE QUERIES
   ========================================================================== */

@media (max-width: 980px) {
  .topbar-inner { grid-template-columns: 1fr; }
  .topbar-center { justify-content: flex-start; flex-wrap: wrap; }
  .prefs-panel { right: 0; top: calc(100% + 10px); transform-origin: top right; transform: translateY(-6px) scale(.98); }
}

@media (max-width: 720px) {
  :root { --col-min: 100%; --col-max: 100%; }
  .columns { grid-template-columns: 1fr; }
  .switch-columns { flex-direction: column; align-items: center; }
  .switch-columns .column { width: 100%; max-width: min(560px, calc(100vw - (var(--gutter) * 2))); }
}
